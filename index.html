<!DOCTYPE html>
<html lang="en">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="referrer" content="same-origin">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

<title>Do not go gentle into that good night.</title>
</head>
<body>

<nav class="navbar navbar-light" style="background-color: dimgray;">
  <a class="navbar-brand" href="#">
    <img src="https://getbootstrap.com/docs/4.4/assets/brand/bootstrap-solid.svg" width="30" height="30" alt="">
  </a>
</nav>

<div class="container">
  <div class="jumbotron">
    <h1 class="display-4">Hello, world!</h1>
    <p class="lead">This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured content or information.</p>
    <hr class="my-4">
    <p id="ft">It uses utility classes for typography and spacing to space content out within the larger container.</p>
    <button id="link" class="btn btn-danger" href="#" type="button" data-toggle="collapse" data-target="#icollapse" aria-expanded="false" aria-controls="icollapse">Learn more</button>
  </div>

  <div class="collapse" id="icollapse"></div>

  <div id="carousel" class="carousel slide" data-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <svg class="bd-placeholder-img bd-placeholder-img-lg d-block w-100" width="800" height="400" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: First slide">
          <title>Placeholder</title>
          <rect width="100%" height="100%" fill="#777"></rect>
          <text x="50%" y="50%" fill="#555" dy=".3em">First slide</text>
        </svg>
      </div>
      <div class="carousel-item">
        <svg class="bd-placeholder-img bd-placeholder-img-lg d-block w-100" width="800" height="400" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Second slide">
          <title>Placeholder</title>
          <rect width="100%" height="100%" fill="#666"></rect>
          <text x="50%" y="50%" fill="#444" dy=".3em">Second slide</text>
        </svg>
      </div>
      <div class="carousel-item">
        <svg class="bd-placeholder-img bd-placeholder-img-lg d-block w-100" width="800" height="400" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Third slide">
          <title>Placeholder</title>
          <rect width="100%" height="100%" fill="#555"></rect>
          <text x="50%" y="50%" fill="#333" dy=".3em">Third slide</text>
        </svg>
      </div>

      <a class="carousel-control-prev" href="#carousel" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carousel" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>

    <ol class="carousel-indicators">
      <li data-target="#carousel" data-slide-to="0" class="active"></li>
      <li data-target="#carousel" data-slide-to="1"></li>
      <li data-target="#carousel" data-slide-to="2"></li>
    </ol>
  </div>
</div>

<div id="preview" class="container" style="margin-bottom: 2rem; display: none;">
  <h3>Preview</h3>
  <!-- 16:9 aspect ratio -->
  <div class="embed-responsive embed-responsive-16by9">
    <video class="embed-responsive-item" controls></video>
  </div>
</div>
<!-- <input type="file" id="fileToUpload" accept=".json" onchange="load()"/>-->

<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script>
function renderPage(evt) {
    var xhr = evt.target;
    if (xhr.readyState != 4 || xhr.status != 200) {
        $("div.jumbotron h1:first").text(xhr.readyState == 4 ? "Invalid request" : "Loading...");
        return;
    }
    var info = evt.target.response;
    //console.log(info);

    //var info = JSON.parse(evt.target.result);
    $("div.jumbotron h1:first").text(info.name);
    $("div.jumbotron p.lead").text(info.title);
    var labels = $("#ft").empty();
    for (ft of info.features)
        labels.append(`<span class="badge badge-pill badge-light">${ft}</span>`);
    $("#link").text(info.id);
    $("#link").attr("href", info.hp);
    $("#link").attr("target", "_blank");
    $(".carousel-item").remove();
    for (let i = 1; i <= info.pn; i++)
        $(".carousel-inner").append(`<div class="carousel-item"><img src="${info.irl}jp-${i}.jpg" class="mx-auto d-block w-100"></div>`);
    $(".carousel-item:first").addClass("active");
    $(".carousel-indicators li").remove();
    for (let i = 1; i <= info.pn; i++)
        $(".carousel-indicators").append(`<li data-target="#carousel" data-slide-to="${i}"><img src="${info.irl}-${i}.jpg" class="d-block w-100"></li>`);
    $(".carousel-indicators li:first").addClass("active");
    $("video.embed-responsive-item").attr("poster", `${info.irl}pl.jpg`);
    for (tp of ["dmb", "dm", "sm"])
        $("video.embed-responsive-item").append(`<source src="${info.vrl}_${tp}_w.mp4" type="video/mp4">`);
    $("#preview").show();

    $("head").append('<link rel="stylesheet" type="text/css" href="index.css">');
    $("nav.navbar").attr("style", "background-color: hotpink;");
    $("a.navbar-brand").html(`<img src="${info.logo}" alt="logo">`);
}

function load() {
    var urlParams = new URLSearchParams(location.search);
    var token = urlParams.get('token');
    if (token == null)
        return;

    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = renderPage;
    var url = "https://xuming.design/render";
    var data = JSON.stringify({token: token});
    xhttp.open("POST", url, true);
    xhttp.setRequestHeader("Content-Type", "application/json");
    xhttp.responseType = "json";
    xhttp.send(data);
    /*var reader = new FileReader();
    var file = document.getElementById("fileToUpload").files[0];
    reader.onload = renderPage;
    reader.readAsText(file);*/
}

$(function() {
    load();
});
</script>
<script type="text/javascript" src="main.min.js"></script>

</body>
</html>